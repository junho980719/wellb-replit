
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/user/login-layout}">

<!-- 헤더 오버라이드 -->
<div layout:fragment="header" class="header-section">
    <div class="container-fluid">
        <div class="row align-items-center p-3">
            <div class="col-2">
                <button type="button" class="btn btn-link text-white p-0" 
                        hx-get="/user/login" hx-target="body">
                    <i class="fas fa-arrow-left" style="font-size: 20px;"></i>
                </button>
            </div>
            <div class="col-8 text-center">
                <h5 class="text-white mb-0">회원가입</h5>
            </div>
            <div class="col-2"></div>
        </div>
    </div>
</div>

<!-- 콘텐츠 영역 -->
<div layout:fragment="content" class="signup-form-container">
    <div class="text-center mb-4">
        <div class="app-logo">
            <div class="check-icon mx-auto mb-3">
                <span>1</span>
            </div>
            <h4 class="text-dark mb-2">기본정보 입력</h4>
            <p class="text-muted">회원가입을 위한 기본 정보를 입력해주세요</p>
        </div>
    </div>

    <form class="mb-4" hx-post="/user/auth/signup" hx-target="#main-content">
        <!-- 이름 -->
        <div class="mb-3">
            <label for="name" class="form-label fw-semibold">이름 <span class="text-danger">*</span></label>
            <input type="text" class="form-control custom-input" id="name" name="name" placeholder="이름을 입력하세요" required>
        </div>

        <!-- 생년월일 -->
        <div class="mb-3">
            <label for="birthdate" class="form-label fw-semibold">생년월일 <span class="text-danger">*</span></label>
            <input type="date" class="form-control custom-input" id="birthdate" name="birthdate" required>
        </div>

        <!-- 성별 -->
        <div class="mb-3">
            <label class="form-label fw-semibold">성별 <span class="text-danger">*</span></label>
            <div class="row g-2">
                <div class="col-6">
                    <div class="gender-option" onclick="selectGender('male', this)">
                        <i class="fas fa-mars mb-2" style="font-size: 20px;"></i>
                        <div>남성</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="gender-option" onclick="selectGender('female', this)">
                        <i class="fas fa-venus mb-2" style="font-size: 20px;"></i>
                        <div>여성</div>
                    </div>
                </div>
            </div>
            <input type="hidden" id="gender" name="gender" required>
        </div>

        <!-- 연락처 -->
        <div class="mb-3">
            <label for="phone" class="form-label fw-semibold">연락처 <span class="text-danger">*</span></label>
            <div class="row g-2">
                <div class="col-8">
                    <input type="tel" class="form-control custom-input" id="phone" name="phone" placeholder="010-0000-0000" required>
                </div>
                <div class="col-4">
                    <button type="button" class="verification-btn w-100" onclick="sendVerificationCode()">
                        인증번호
                    </button>
                </div>
            </div>
            
            <!-- 인증번호 입력란 -->
            <div class="verification-code-section" id="verificationSection">
                <label for="verificationCode" class="form-label fw-semibold small">인증번호</label>
                <div class="row g-2">
                    <div class="col-8">
                        <input type="text" class="form-control verification-input" id="verificationCode" name="verificationCode" placeholder="인증번호 6자리 입력" maxlength="6">
                    </div>
                    <div class="col-4">
                        <button type="button" class="verification-btn w-100" onclick="verifyCode()">
                            확인
                        </button>
                    </div>
                </div>
                <div class="mt-2">
                    <small class="text-muted">
                        <span id="timer">03:00</span> 
                        <button type="button" class="btn btn-link p-0 small" onclick="resendCode()">재전송</button>
                    </small>
                </div>
            </div>
        </div>

        <!-- 이메일 -->
        <div class="mb-4">
            <label for="email" class="form-label fw-semibold">이메일 주소 <span class="text-danger">*</span></label>
            <input type="email" class="form-control custom-input" id="email" name="email" placeholder="example@email.com" required>
        </div>

        <!-- 약관 동의 -->
        <div class="terms-section">
            <div class="mb-3">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" id="agreeAll" onchange="toggleAllTerms()">
                    <label class="form-check-label fw-bold" for="agreeAll">
                        전체 동의
                    </label>
                </div>
            </div>
            
            <hr class="my-3">
            
            <div class="mb-3">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input required-term" id="terms" name="terms" required>
                    <label class="form-check-label" for="terms">
                        <span class="text-danger">[필수]</span> 
                        <a href="#" class="terms-link">이용약관</a>에 동의합니다
                    </label>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input required-term" id="privacy" name="privacy" required>
                    <label class="form-check-label" for="privacy">
                        <span class="text-danger">[필수]</span> 
                        <a href="#" class="terms-link">개인정보 수집 및 이용</a>에 동의합니다
                    </label>
                </div>
            </div>
            
            <div class="mb-0">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input optional-term" id="marketing" name="marketing">
                    <label class="form-check-label" for="marketing">
                        <span class="text-muted">[선택]</span> 
                        마케팅 수신 동의 (SMS, 이메일)
                    </label>
                </div>
            </div>
        </div>

        <div class="d-grid mt-4">
            <button type="button" class="btn btn-primary-custom btn-lg" 
                    hx-get="/user/signup-step2" hx-target="body">
                다음 단계
            </button>
        </div>
    </form>

    <div class="text-center">
        <p class="text-muted mb-3">이미 계정이 있으신가요?</p>
        <button type="button" class="btn btn-link text-decoration-none" 
                hx-get="/user/login" hx-target="body">
            로그인하기
        </button>
    </div>
</div>

<!-- 페이지별 스크립트 -->
<th:block layout:fragment="scripts">
    <script>
        // 성별 선택
        function selectGender(gender, element) {
            document.querySelectorAll('.gender-option').forEach(el => {
                el.classList.remove('selected');
            });
            element.classList.add('selected');
            document.getElementById('gender').value = gender;
        }
        
        // 인증번호 전송
        function sendVerificationCode() {
            const phone = document.getElementById('phone').value;
            if (!phone) {
                alert('연락처를 입력해주세요.');
                return;
            }
            
            document.getElementById('verificationSection').classList.add('show');
            startTimer();
            alert('인증번호가 전송되었습니다.');
        }
        
        // 인증번호 확인
        function verifyCode() {
            const code = document.getElementById('verificationCode').value;
            if (!code || code.length !== 6) {
                alert('6자리 인증번호를 입력해주세요.');
                return;
            }
            alert('인증이 완료되었습니다.');
        }
        
        // 인증번호 재전송
        function resendCode() {
            document.getElementById('verificationCode').value = '';
            startTimer();
            alert('인증번호가 재전송되었습니다.');
        }
        
        // 타이머 시작
        function startTimer() {
            let time = 180; // 3분
            const timer = document.getElementById('timer');
            
            const interval = setInterval(() => {
                const minutes = Math.floor(time / 60);
                const seconds = time % 60;
                timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (time === 0) {
                    clearInterval(interval);
                    timer.textContent = '시간 만료';
                }
                time--;
            }, 1000);
        }
        
        // 전체 동의 토글
        function toggleAllTerms() {
            const agreeAll = document.getElementById('agreeAll');
            const requiredTerms = document.querySelectorAll('.required-term');
            const optionalTerms = document.querySelectorAll('.optional-term');
            
            if (agreeAll.checked) {
                requiredTerms.forEach(term => term.checked = true);
                optionalTerms.forEach(term => term.checked = true);
            } else {
                requiredTerms.forEach(term => term.checked = false);
                optionalTerms.forEach(term => term.checked = false);
            }
        }
        
        // 개별 약관 체크 시 전체 동의 상태 업데이트
        document.addEventListener('DOMContentLoaded', function() {
            const allTerms = document.querySelectorAll('.required-term, .optional-term');
            const agreeAll = document.getElementById('agreeAll');
            
            allTerms.forEach(term => {
                term.addEventListener('change', function() {
                    const checkedTerms = document.querySelectorAll('.required-term:checked, .optional-term:checked');
                    agreeAll.checked = checkedTerms.length === allTerms.length;
                });
            });
        });
        
        // 전화번호 자동 포맷팅
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/[^0-9]/g, '');
            if (value.length >= 3 && value.length <= 7) {
                value = value.replace(/(\d{3})(\d+)/, '$1-$2');
            } else if (value.length > 7) {
                value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
            }
            e.target.value = value;
        });
    </script>
</th:block>
</html>
